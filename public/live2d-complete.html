<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
	<title>洛天依live2D模型演示</title>
	<style>
		#landlord {
			position: fixed;
			right: 0px;
			bottom: 0px;
			width: 280px;
			height: 250px;
			z-index: 9999;
			font-size: 0;
			transition: all .3s ease-in-out;
		}
		
		#live2d {
			width: 280px;
			height: 250px;
			cursor: grab;
		}
		
		.message {
			position: absolute;
			top: 30px;
			left: 20px;
			padding: 10px 15px;
			background: rgba(0,0,0,0.7);
			color: #fff;
			border-radius: 10px;
			font-size: 14px;
			max-width: 200px;
			word-wrap: break-word;
		}
		
		.hide-button {
			position: absolute;
			top: 10px;
			right: 10px;
			width: 30px;
			height: 30px;
			background: rgba(0,0,0,0.5);
			border-radius: 50%;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			color: #fff;
			font-size: 16px;
		}
		
		.sing-button {
			position: absolute;
			bottom: 10px;
			right: 10px;
			padding: 5px 10px;
			background: rgba(0,0,0,0.5);
			border-radius: 5px;
			cursor: pointer;
			color: #fff;
			font-size: 12px;
		}
	</style>
</head>
<body>

<div id="landlord">
    <div class="message" style="opacity:0"></div>
    <canvas id="live2d" width="280" height="250" class="live2d"></canvas>
    <div class="hide-button" onclick="hideLive2D()">×</div>
	<div class="sing-button" onclick="playSong()">Sing</div>
</div>

<!-- 使用本地jQuery -->
<script src="https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>

<!-- 加载Live2D核心库 -->
<script src="/luotianyi-live2d/live2d/js/live2d.js"></script>

<!-- 加载消息脚本 -->
<script src="/luotianyi-live2d/live2d/js/message.js"></script>

<script>
	// 隐藏Live2D
	function hideLive2D() {
		$('#landlord').css('display', 'none');
	}
	
	// 播放歌曲
	function playSong() {
		$('.message').html('正在播放歌曲...').fadeTo(200, 1).delay(2000).fadeTo(200, 0);
	}
	
	// 显示消息
	function showMessage(msg, duration) {
		$('.message').html(msg).fadeTo(200, 1);
		if (duration) {
			setTimeout(function() {
				$('.message').fadeTo(200, 0);
			}, duration);
		}
	}
	
	// 初始化Live2D
	function initLive2D() {
		console.log('开始初始化Live2D');
		
		// 检查Live2D是否已加载
		if (typeof Live2D === 'undefined') {
			console.error('Live2D库未加载');
			showMessage('Live2D库未加载', 3000);
			return;
		}
		
		// 获取canvas元素
		var canvas = document.getElementById('live2d');
		if (!canvas) {
			console.error('找不到canvas元素');
			showMessage('找不到canvas元素', 3000);
			return;
		}
		
		// 尝试获取WebGL上下文
		var gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
		if (!gl) {
			console.error('WebGL不受支持');
			showMessage('WebGL不受支持', 3000);
			return;
		}
		
		// 设置Live2D的GL上下文
		try {
			Live2D.setGL(gl);
			console.log('Live2D GL上下文设置成功');
		} catch (error) {
			console.error('设置Live2D GL上下文失败:', error);
			showMessage('设置Live2D GL上下文失败: ' + error.message, 3000);
			return;
		}
		
		// 显示加载消息
		showMessage('正在加载模型...', 0);
		
		// 尝试加载模型
		try {
			// 直接使用模型JSON数据
			var modelPath = "/luotianyi-live2d/live2d/model/tianyi/model.json";
			console.log('开始加载模型:', modelPath);
			
			// 尝试获取模型文件
			fetch(modelPath)
				.then(response => {
					if (!response.ok) {
						throw new Error(`HTTP错误! 状态: ${response.status}`);
					}
					return response.json();
				})
				.then(modelData => {
					console.log('模型JSON加载成功', modelData);
					
					// 尝试加载模型
					// 这里我们需要实现完整的模型加载逻辑
					// 由于我们没有完整的Live2D API，这里只是模拟
					showMessage('模型加载成功！但需要完整实现Live2D渲染', 5000);
					
					// 在canvas上绘制一个简单的占位符
					var ctx = canvas.getContext('2d');
					ctx.fillStyle = '#f0f0f0';
					ctx.fillRect(0, 0, canvas.width, canvas.height);
					ctx.fillStyle = '#333';
					ctx.font = '16px Arial';
					ctx.textAlign = 'center';
					ctx.fillText('Live2D模型占位符', canvas.width/2, canvas.height/2);
					ctx.font = '12px Arial';
					ctx.fillText('模型加载成功，但需要完整实现', canvas.width/2, canvas.height/2 + 20);
				})
				.catch(error => {
					console.error('加载模型失败:', error);
					showMessage('模型加载失败: ' + error.message, 3000);
				});
		} catch (error) {
			console.error('加载模型时出错:', error);
			showMessage('加载模型时出错: ' + error.message, 3000);
		}
	}
	
	// 等待DOM加载完成
	$(document).ready(function() {
		console.log('DOM加载完成，开始初始化Live2D');
		
		// 延迟加载以确保所有脚本都已加载
		setTimeout(function() {
			initLive2D();
		}, 1000);
	});
</script>

</body>
</html>